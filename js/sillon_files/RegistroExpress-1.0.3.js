$(document).ready(function(){callService(GetComunas,"",OnComunasRecived,OnErrorServicio);var a='<div id="divPopUpLogin" title="Portalinmobiliario.com" class="PopUp">'+'<table border="0" cellpading="0" cellspacing="0" width="100%" id="tabla-login">'+"   <tr>"+'       <td width="34%" valign="top">'+'       <table width="100%" align="center" id="tbl-ingreso">'+'           <tr><td class="Titulo">Para continuar debe ingresar sus datos.</td></tr>    '+"       </table>"+'       <form method="post" name="frmLog" ID="frmLog" action="" target="descripcion">'+'       <table width="100%" align="center">'+"           <tr>"+'               <td class="LeftValue" style="width:144px !important;width:160px !important\9;"><label for="Email" style="cursor:pointer;">Ingrese su e-mail:</label></td>'+'               <td class="Datos"nowrap="nowrap" style="font-size:9px; width:141px;"><input class="login" type="text" id="Email" size="24" name="Email" value="" maxlength="70"></td>'+"           </tr>"+"           <tr><td>&nbsp;</td></tr>"+"           <tr>"+'               <td class="Titulo" nowrap="nowrap" colspan="2">¿Tiene contraseña en Portalinmobiliario.com? </td>'+"           </tr>"+"           <tr>"+'               <td valign="top" colspan="2" class="LeftValue"  style="background-color:#FFFFFF !important;text-align:left;width:250px !important\9;" ><input class="rbtnSinPass" type="radio" name="password" value="0" id="rbtnSinPass"><label for="rbtnSinPass" style="cursor:pointer;"> No tengo contraseña, deseo crearla.</label></td>'+"           </tr>"+"           <tr>"+'               <td class="LeftValue"  valign="top" style="text-align:left !important;width:144px !important;width:160px !important\9;"> <input class="rbtnConPass" type="radio" name="password" value="1" checked="checked" id="rbtnConPass"><label for="rbtnConPass" style="cursor:pointer;"> S&iacute;, mi contraseña es:</label></td>'+'               <td class="Datos" id="td-sinpass"  valign="top" nowrap="nowrap" style="font-size:9px; width:141px;"><input class="login" type="password" id="Password" size="24" name="Password" value=""  onkeypress="return clickButton(event,&quot;btnIngresar&quot;);"></td>'+"           </tr>"+"           <tr>"+"               <td></td>    "+"               <td align=\"left\"><a href=\"#\" onclick=\"javascript:window.open('/Personas/Email.asp?Email=','Hijo','left=10,top=10,width=500,height=430,scrollbars=yes,resizable=yes');return false;\"><b>¿Olvidó su contraseña?</b></a></td>"+"           </tr>"+"           <tr><td><td></tr>    "+"           <tr>"+'               <td colspan="2" align="center"><button style="border: 0px; width: 94px; height: 29px; padding:0px; cursor: pointer;" type="submit" name="btnIngresar" id="btnIngresar"><img src="/images/ContinuarBTN-RegistroExpress.png" /></button></td>'+"           </tr>"+'           <tr><td colspan="2"></td></tr> '+'           <tr><td colspan="2" align="left"><hr class="hr-gris"></td></tr>    '+"           <tr>"+'              <td colspan="2" align="left"><span class="tituloRojo"> Algunos de los beneficios de ser un usuario registrado</span>'+'                  <ul class="ulRegistro"><li><span>Podrá conocer <strong>precios y formas de pago.</strong></span></li>'+"                      <li><span>Seleccionar y <strong>guardar sus propiedades favoritas</strong>.</span></li><li><span><strong>Solicitar información adicional</strong> al vendedor de una propiedad o crédito hipotecario.</span></li></ul></td>"+"          </tr>"+"          <tr>"+'               <td style="width:144px !important;width:160px !important\9;">'+"               </td>"+'               <td nowrap="nowrap" style="font-size:9px; width:141px;">'+'                   <div id="btnCerrar1" title="Cerrar" style="cursor:pointer; margin-left: 9px;margin-left: 0px;\9">'+'                     <span style="font-family: arial;color:#07519A;text-decoration:underline;font-size:12px;" class="msj-cerrar"></span>                            '+"                  </div>"+"			   </td>"+"          </tr>"+"       </table>"+"       </form>"+'       <table border="0" cellpading="0" cellspacing="0" width="100%" id="form-registro">'+"          <tr>"+"              <td>  "+'                   <table width="100%" valign="top" style="padding-right:10px;"> '+"                       <tr>"+'                            <td class="Titulo" nowrap="nowrap" style="width: 214px;">Sus datos son</td>'+'                            <td  nowrap="nowrap" align="right">&nbsp;<span id="espacio_span"></span><span class="font-size">(</span><span class="font-size" style="color:red;">*</span><span class="font-size">)</span><span class="font-size">&nbsp;Son datos obligatorios</span></td>'+"                       </tr>"+"                    </table>"+"               </td>     "+"          </tr>"+'          <tr id="tr-registro">'+"            <td>"+'             <form method="post" name="frmDispo" ID="frmDispo" action="info.asp?ID=<%= ProyectoID %>" target="descripcion">'+'                 <table width="100%" id="form-reg">'+"                  <tr>"+'                      <td class="LeftValue" width="47%">E-mail:</td>'+'                      <td class="Datos" width="53%" style="font-size:9px;"><input style="width: 229px !important\9;" class="login" type="text" size="51" name="Email1" id="Email1" value="" maxlength="70" /></td>'+"                  </tr>"+"                  <tr>"+'                      <td class="LeftValue" width="47%">Confirmar e-mail:</td>'+'                      <td class="Datos"  width="53%" style="font-size:9px;"><input style="width: 229px !important\9;" class="login" type="text" size="51" name="Email2" id="Email2" value="" maxlength="70" /></td>'+"                  </tr>"+"                  <tr>"+"                     <td>&nbsp;</td>      "+"                  </tr>"+"                   <tr>              "+'                       <td class="LeftValue" width="47%">Nombre:</td>'+'                       <td class="Datos" width="53%" style="font-size:9px;"><input style="width: 229px !important\9;" class="login" type="text" size="51" value="" maxlength="100" id="Nombre" name="Nombre" /></td>   '+"                   </tr>              "+"                   <tr>"+'                      <td class="LeftValue" width="47%">Apellidos:</td>'+'                      <td class="Datos" width="53%" style="font-size:9px;"><input style="width: 229px !important\9;" class="login" type="text" size="51" name="Apellido" maxlength="100" id="Apellido" value="" /></td>'+"                   </tr>"+"                   <tr>"+'                      <td class="LeftValue" width="47%">G&eacute;nero:</td>'+'                      <td class="Datos" width="53%" style="font-size:9px;">'+'					<input class="login" type="radio" id="masculino" name="generoPersona"  value="1" style="border:0px; width: 15px; margin-left: 10px; margin-right: 3px;" /> <label for="masculino">Masculino</label>'+'                   <input class="login" type="radio" id="femenino"  name="generoPersona"  value="0" style="border:0px; width: 15px; margin-left: 10px; margin-right: 3px;" /><label for="femenino">Femenino</label><span id="spangeneroPersona"></span></td>'+"                   </tr>"+"                    <tr>"+'                       <td class="LeftValue" width="47%">Rut:</td>'+'                       <td class="Datos" width="53%" style="font-size:9px;"><input style="width: 160px !important;" class="login" type="text" size="12" name="Rut" maxlength="100" id="Rut" value="" />&nbsp;Ej XX.XXX.XXX-X&nbsp;</td>'+"                   </tr>"+"                  <tr>"+'                      <td class="LeftValue" width="47%">Comuna donde vive:</td>'+'                      <td class="Datos" width="53%" style="font-size:9px;"><select style="width: 229px !important\9;" id="Comuna" name="Comuna" class="login" style="width: 237px;" size="1"></select></td>'+"                  </tr>"+"                   <tr>"+'                      <td class="LeftValue" width="34%" valign="top" style="padding-top: 3px;">Teléfono:</td>'+'                      <td class="Datos" width="53%" style="color:#808080;font-size:9px;">'+'                          <input type="hidden" name="Otros" value="" />'+'                          <select id="CmbTelefono" name="CmbTelefono" class="login" size="1" style="width:120px; margin-bottom: 3px;">'+'                              <option value="0">Selecciona...</option>'+'                              <option value="1">Celular</option>'+'                              <option value="2">Particular</option>'+'                              <option value="3">Comercial</option>'+"                          </select><br />"+'                          <span style="color: Black;font-size: 10px;">Cod. &aacute;rea</span>'+'                          <input class="login" style="width:42px;" type="text" size="5" name="CodTelefono" id="CodTelefono" maxlength="3" onblur="LimpiarNumero(this);" />&nbsp;<span style="color: Black;font-size: 10px;">N&#176;</span>'+'                          <input class="login" type="text" size="6" name="NumTelefono" id="NumTelefono" maxlength="8" value="" onblur="LimpiarNumero(this);"/>'+"                    </td>"+"                   </tr>"+'                   <tr><td></td><td><span style="color: #808080;font-size:10px;">Utilizar al menos 6 números y/o letras<span></td></tr>'+"                   <tr>"+'                      <td class="LeftValue" width="47%" style="width:34%;">Contraseña:</td>'+'                      <td class="Datos" width="53%" style="color:#808080;font-size:9px;"><input style="width: 229px !important\9;" class="login" type="password" size="24" name="Password1" ID="Password1" onclick="this.value=\'\'" /></td>'+"                   </tr>"+"                   <tr>"+'                      <td class="LeftValue" width="47%" style="width:34%;">Confirmar contraseña:</td>'+'                      <td class="Datos" width="53%" style="color:#808080;font-size:9px;"><input style="width: 229px !important\9;" class="login" type="password" size="24" name="Password2" ID="Password2" onclick="this.value=\'\'" /></td>'+"                   </tr>"+"                   <tr><td></td></tr>"+"                   <tr><td></td></tr>"+"                   <tr>"+'                       <td colspan="2" align="center"><button style="border: 0px; width: 94px; height: 30px; padding:0px; cursor: pointer;" type="submit" name="btnReg" id="btnReg"><img src="/images/registreseBTN.png" /></button></td>'+"                   </tr>"+'                   <tr><td colspan="2" align="left"></td></tr>    '+'                   <tr><td colspan="2" align="center">Al registrarse est&aacute; aceptando las <a href="/info/legal/default.asp" target="_blank">Condiciones de Uso de Portalinmobiliario.com</a></td></tr>'+'                    <tr><td colspan="2"></td></tr> '+'                    <tr><td colspan="2" align="left"><hr class="hr-gris"></td></tr>    '+"                    <tr>"+'                        <td colspan="2" align="left"><span class="tituloRojo">Algunos de los beneficios de ser un usuario registrado</span>'+'                         <ul class="ulRegistro"><li><span>Podrá conocer <strong>precios y formas de pago.</strong></span></li>'+"                      <li><span>Seleccionar y <strong>guardar sus propiedades favoritas</strong>.</span></li><li><span><strong>Solicitar información adicional</strong> al vendedor de una propiedad o crédito hipotecario.</span></li></ul></td>"+"                  </tr>"+'                       <tr><td style="width:144px !important;width:160px !important\9;">'+"                       </td>"+'                       <td nowrap="nowrap" style="font-size:9px; width:141px;">'+'                       <div id="btnCerrar2" title="Cerrar" style="cursor:pointer; margin-left: 9px;margin-left: 0px\9;">'+'                           <span role="button" unselectable="on"  style="font-family: arial;color:#07519A;text-decoration:underline;font-size:12px;" class="msj-cerrar"></span>                            '+"                       </div>"+"			        </td></tr>"+"                </table>  "+"              </form>"+"           </td>"+"        </tr>"+"    </table>"+'       <div id="divError" style="visibility: hidden; display: none; text-align:justify; padding-left:13px; padding-right:13px; padding-top:10px;">'+'       <font color="red">Tus datos no fueron encontrados, o no coinciden. Por favor intenta'+"        nuevamente y asegúrate de no haber presionado BLOQ MAYÚS accidentalmente.</font>"+"       </div>"+"       </td></tr></table>"+"</div>";var b=451;if($("#divPopUpLogin").length==0){$("body").append(a);$("#tbl-ingreso").show();$("#frmLog").show();$("#form-registro").hide();$("#tr-registro").hide();$("#divPopUpLogin").dialog({bgiframe:false,width:b,modal:true,autoOpen:false,draggable:true,resizable:false,closeOnEscape:false,open:function(){$(".ui-dialog-titlebar-close").hide();$("#btnCerrar1").click(function(){$("#divPopUpLogin").dialog("close")});$("#btnCerrar2").click(function(){$("#divPopUpLogin").dialog("close")});$("#frmDispo").submit();$("#tbl-ingreso").show();$("#frmLog").show();$("#form-registro").hide();$("#tr-registro").hide();context();$("#CmbTelefono").change(function(){if(this.value==1){$("#CodTelefono").val("9")}else{if(this.value==2||this.value==3){$("#CodTelefono").val($("#Comuna option:selected").attr("codigo"))}else{$("#CodTelefono").val("")}}$("#CodTelefono").focus();$("#CodTelefono").blur();$("#NumTelefono").focus();$("#NumTelefono").blur()});$("#Comuna").change(function(){if($("#CmbTelefono option:selected").val()==2||$("#CmbTelefono option:selected").val()==3){$("#CodTelefono").val($("#Comuna option:selected").attr("codigo"))}$("#CodTelefono").focus();$("#CodTelefono").blur()});$("#Comuna").blur(function(){$("#Comuna").click();$("#CmbTelefono").focus()});$("#CmbTelefono").blur(function(){$("#CmbTelefono").click();$("#CodTelefono").focus()});$("#divPopUpLogin").height("auto");$("#divPopUpLogin").css("padding","10px");if(!jQuery.browser.opera){$("#Email, #Password, #Email1, #Email2, #Password1, #Password2").bind("cut copy paste",function(c){c.preventDefault()})}else{$("#Email, #Password, #Email1, #Email2, #Password1, #Password2").keypress(function(c){if(c.ctrlKey&&(c.which==118||c.which==120||c.which==99||c.which==0)){return false}else{return true}})}$("#Email, #Password, #Email1, #Email2, #Password1, #Password2").bind("contextmenu",function(c){c.preventDefault()})},close:function(){reset();if($.isFunction(registroExpressOnClose)){if($("#tbl-ingreso").css("display")!="none"){registroExpressOnClose("logeo")}else{registroExpressOnClose("registro")}}}});$(".rbtnSinPass").click(function(){$("#Password").css("background-color","D4D0C8");$("#Password").attr("disabled",true);$(".error2 #div-error-pass").hide();$("#td-sinpass label.error2").hide();$("#divError").hide()});$(".rbtnConPass").click(function(){$("#Password").css("background-color","FFFFFF");$("#Password").removeAttr("disabled");$("#divError").hide()})}$("#Email").keydown(function(){$("#divError").hide()});$("#Password").keydown(function(){$("#divError").hide()});CrearValidadoresRegistro()});function OnComunasRecived(c){var b=new Option();b.text="Seleccione...";b.value="0";$("#Comuna")[0].options[0]=b;var a=new Array();jQuery.each(c,function(){if(this.IDComuna!=342){a.push(this)}});for(i=0;i<a.length;i++){var b=new Option();b.text=a[i].Nombre;b.value=a[i].IDComuna.toString();b.codigo=a[i].CodigoArea.toString();$("#Comuna")[0].options[i+1]=b}}function onAutenticado(a){if(a!=null){$("#divPopUpLogin").dialog("close");if($.isFunction(registroExpressOnLogeo)){registroExpressOnLogeo()}}else{var b=document.getElementById("divError");b.style.display="block";b.style.visibility="visible"}}function OnErrorServicio(a){if(a){if(a.Message!=""){alert(a.Message)}}}function ValidarNombresRestringidos(a,b){if(!reValoresRestringidos){return true}return !reValoresRestringidos.test(a)}function EmailOK(a,c){var b=/^[a-zA-Z0-9._-]+@([a-zA-Z0-9.-]+\.)+[a-zA-Z0-9.-]{2,8}$/;return b.test(a)}function autenticar(a,b){var c;if($("input[name='password']:checked").val()=="1"){var d='{"mail": "'+a+'" , "pwd": "'+b+'"}';callService(AutenticarUsuarioPortal,d,onAutenticado,OnErrorServicio)}else{$("#Password").css("background-color","D4D0C8");$("#Password").attr("disabled",true);$("#form-registro").show();$("#tbl-ingreso").hide();$("#frmLog").hide();$("#tr-registro").show();$("#Email1").val(a);$("#Email1").focus()}}function context(){var a="";if($("#iFrameFicha").contents().find(".pageBtn").length>0){a=$("#iFrameFicha").contents().find(".pageBtn").attr("id")}else{if($(".pageBtn").attr("id")!=null){a=$(".pageBtn").attr("id")}else{a=""}}if(a!=""){$(".msj-cerrar").html("No&nbsp;"+a)}else{$(".msj-cerrar").html("Cerrar")}}function reset(){var a=$("#frmDispo").validate();a.resetForm();a=$("#frmLog").validate();a.resetForm();$("#frmDispo").each(function(){this.reset()});$("#frmLog").each(function(){this.reset()});$("#Password").css("background-color","FFFFFF");$("#Password").attr("disabled",false);$("#divError").hide()}function LimpiarNumero(c){var b=$(c).val();var a="";for(i=0;i<b.length;i++){if(b.charCodeAt(i)>=48&&b.charCodeAt(i)<=57){a+=b.charAt(i)}}$(c).val(a)}function CrearValidadoresRegistro(){$("#frmDispo").validate({rules:{Nombre:{required:true,nombresRestringidos:true,check_name:true},Apellido:{required:true,nombresRestringidos:true,check_name:true},Rut:{required:true,formato_rut:true,rut_valido:true},generoPersona:{required:true},Comuna:{min:1},CmbTelefono:{min:1},CodTelefono:{required:true},NumTelefono:{required:true,rangePorTipo:true},Email1:{required:true,email:true,email2:true},Email2:{required:true,email:true,email2:true,equalTo:"#Email1"},Password1:{required:true,rangelength:[6,50]},Password2:{required:true,rangelength:[6,50],equalTo:"#Password1"}},messages:{Nombre:{required:"*"},Apellido:{required:"*"},Rut:{required:"*"},generoPersona:{required:"*"},Comuna:{min:"*"},CmbTelefono:{min:"*"},CodTelefono:{required:"*"},NumTelefono:{required:"*",rangePorTipo:function(){return $("#CmbTelefono option:selected").val()==1?"<br />El teléfono celular debe poseer 8 dígitos":"<br />El número de teléfono debe tener entre 6 y 7 dígitos."}},Email1:{required:"*",email:"<br />El e-mail ingresado no es válido."},Email2:{required:"*",email:"<br />El e-mail ingresado no es válido.",equalTo:"<br />Los e-mail deben ser iguales."},Password1:{required:"*",rangelength:"<br />La contraseña debe tener al menos 6 caracteres con números y/o letras."},Password2:{required:"*",rangelength:"<br />La contraseña debe tener al menos 6 caracteres con números y/o letras.",equalTo:"<br />Las contraseñas deben ser iguales."}},submitHandler:function(){$("#btnReg").attr("disabled",true);var a="";if($("#CmbTelefono").val()=="1"){a="Celular"}else{if($("#CmbTelefono").val()=="2"){a="Telefono1"}else{a="Telefono2"}}$.post("/personas/registrarnuevo.asp?RE=1",{Nombre:$("#Nombre").val(),Apellido:$("#Apellido").val(),Rut:$("#Rut").val(),Comuna:$("#Comuna").val(),CmbTelefono:a,CodTelefono:$("#CodTelefono").val(),NumTelefono:$("#NumTelefono").val(),Email:$("#Email1").val(),Email2:$("#Email2").val(),Password1:$("#Password1").val(),Password2:$("#Password2").val(),btnReg:"1",Diario:"on",QuiereInfo:"on",PopUpRegistroExpress:"1",Sexo:$("input[name='generoPersona']:checked").val()},function(b){if(b!=""){alert(b)}else{if($.isFunction(registroExpressOnRegistro)){registroExpressOnRegistro()}$("input[name='password']:checked").val("1");autenticar($("#Email1").val(),$("#Password1").val())}});return false},errorPlacement:function(b,a){if(a.attr("name")=="generoPersona"){$(b).addClass("errorTelefono");$("#spangeneroPersona").append(b)}else{b.insertAfter(a)}},onkeyup:false});$.validator.addMethod("nombresRestringidos",ValidarNombresRestringidos,"<br />Contenido inválido.");$.validator.addMethod("email2",EmailOK,"<br />El e-mail ingresado no es válido.");$.validator.addMethod("check_name",function(b,c,a){return this.optional(c)||/^[a-zA-Z áéíóúAÉÍÓÚÑñ\']+$/i.test(b)},jQuery.format("<br />Caracteres no válidos"));$.validator.addMethod("formato_rut",function(b,d,a){var c="^(\\d\\d\\.\\d|\\d\\.\\d|\\d)?\\d{2}.\\d{3}-[\\d,k,K]";var e=new RegExp(c,"gi");return this.optional(d)||b.match(e)},jQuery.format("<br />El RUT no posee el formato requerido"));$.validator.addMethod("rut_valido",function(b,c,a){return this.optional(c)||ValidarRut(b)},jQuery.format("<br />El RUT ingresado es incorrecto"));$.validator.addMethod("rangePorTipo",function(b,d,a){var c=true;if($("#CmbTelefono").val()==1){if(b.length>8||b.length<8){c=false}}else{if($("#CmbTelefono").val()==2||$("#CmbTelefono").val()==3){if(b.length>8||b.length<6){c=false}}}return c},jQuery.format("<br />Caracteres no válidos"));$("#frmLog").validate({rules:{Email:{required:true,email:true},Password:{required:true}},messages:{Email:{required:"<div id='div-error-mail' style='font-size:12px;'>E-mail requerido.</div>",email:"<div style='font-size:12px;width:180px;'>El e-mail ingresado no es válido.</div>"},Password:{required:"<div id='div-error-pass' style='font-size:12px;'>Contraseña requerida.</div>"}},submitHandler:function(){autenticar($("#Email").val(),$("#Password").val())},errorPlacement:function(b,a){if(a.attr("name")=="generoPersona"){$(b).addClass("errorTelefono");$("#spangeneroPersona").append(b)}else{b.insertAfter(a)}},onkeyup:false,errorClass:"error2"})};