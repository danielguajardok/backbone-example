(function(z){var g,r=this,c=r.document,t=z(c),u=z(r),e=1.26,d=true,j=30000,q=false,k=navigator.userAgent.toLowerCase(),x=r.location.hash.replace(/#\//,""),b=(function(){var C=3,B=c.createElement("div"),D=B.getElementsByTagName("i");do{B.innerHTML="<!--[if gt IE "+(++C)+"]><i></i><![endif]-->"}while(D[0]);return C>4?C:g}()),n=function(){return{html:c.documentElement,body:c.body,head:c.getElementsByTagName("head")[0],title:c.title}},y="data ready thumbnail loadstart loadfinish image play pause progress "+"fullscreen_enter fullscreen_exit idle_enter idle_exit rescale "+"lightbox_open lightbox_close lightbox_image",v=(function(){var B=[];z.each(y.split(" "),function(D,C){B.push(C);if(/_/.test(C)){B.push(C.replace(/_/g,""))}});return B}()),m=function(C){var B;if(typeof C!=="object"){return C}z.each(C,function(E,D){if(/^[a-z]+_/.test(E)){B="";z.each(E.split("_"),function(F,G){B+=F>0?G.substr(0,1).toUpperCase()+G.substr(1):G});C[B]=D;delete C[E]}});return C},s=function(B){if(z.inArray(B,v)>-1){return Galleria[B.toUpperCase()]}return B},l={trunk:{},add:function(E,B,F,D){D=D||false;this.clear(E);if(D){var C=B;B=function(){C();l.add(E,B,F)}}this.trunk[E]=r.setTimeout(B,F)},clear:function(D){var B=function(E){r.clearTimeout(this.trunk[E]);delete this.trunk[E]},C;if(!!D&&D in this.trunk){B.call(l,D)}else{if(typeof D==="undefined"){for(C in this.trunk){if(this.trunk.hasOwnProperty(C)){B.call(l,C)}}}}}},i=[],a=[],A=false,p=false,o=[],w=function(B){Galleria.theme=B;z.each(o,function(D,C){if(!C._initialized){C._init.call(C)}})},f=(function(){return{array:function(B){return Array.prototype.slice.call(B,0)},create:function(D,B){B=B||"div";var C=c.createElement(B);C.className=D;return C},getScriptPath:function(C){C=C||z("script:last").attr("src");var B=C.split("/");if(B.length==1){return""}B.pop();return B.join("/")+"/"},animate:(function(){var J=(function(O){var N="transition WebkitTransition MozTransition OTransition".split(" "),P;if(r.opera){return false}for(P=0;N[P];P++){if(typeof O[N[P]]!=="undefined"){return N[P]}}return false}((c.body||c.documentElement).style));var I={MozTransition:"transitionend",OTransition:"oTransitionEnd",WebkitTransition:"webkitTransitionEnd",transition:"transitionend"}[J];var M={_default:[0.25,0.1,0.25,1],galleria:[0.645,0.045,0.355,1],galleriaIn:[0.55,0.085,0.68,0.53],galleriaOut:[0.25,0.46,0.45,0.94],ease:[0.25,0,0.25,1],linear:[0.25,0.25,0.75,0.75],"ease-in":[0.42,0,1,1],"ease-out":[0,0,0.58,1],"ease-in-out":[0.42,0,0.58,1]};var G=function(P,N,Q){var O={};Q=Q||"transition";z.each("webkit moz ms o".split(" "),function(){O["-"+this+"-"+Q]=N});P.css(O)};var E=function(N){G(N,"none","transition");if(Galleria.WEBKIT&&Galleria.TOUCH){G(N,"translate3d(0,0,0)","transform");if(N.data("revert")){N.css(N.data("revert"));N.data("revert",null)}}};var B,F,K,C,H,D,L;return function(O,N,P){P=z.extend({duration:400,complete:function(){},stop:false},P);O=z(O);if(!P.duration){O.css(N);P.complete.call(O[0]);return}if(!J){O.animate(N,P);return}if(P.stop){O.unbind(I);E(O)}B=false;z.each(N,function(Q,R){L=O.css(Q);if(f.parseValue(L)!=f.parseValue(R)){B=true}O.css(Q,L)});if(!B){r.setTimeout(function(){P.complete.call(O[0])},P.duration);return}F=[];K=P.easing in M?M[P.easing]:M._default;C=" "+P.duration+"ms"+" cubic-bezier("+K.join(",")+")";r.setTimeout(function(){O.one(I,(function(Q){return function(){E(Q);P.complete.call(Q[0])}}(O)));if(Galleria.WEBKIT&&Galleria.TOUCH){H={};D=[0,0,0];z.each(["left","top"],function(R,Q){if(Q in N){D[R]=(f.parseValue(N[Q])-f.parseValue(O.css(Q)))+"px";H[Q]=N[Q];delete N[Q]}});if(D[0]||D[1]){O.data("revert",H);F.push("-webkit-transform"+C);G(O,"translate3d("+D.join(",")+")","transform")}}z.each(N,function(R,Q){F.push(R+C)});G(O,F.join(","));O.css(N)},1)}}()),removeAlpha:function(D){if(b<9&&D){var C=D.style,B=D.currentStyle,E=B&&B.filter||C.filter||"";if(/alpha/.test(E)){C.filter=E.replace(/alpha\([^)]*\)/i,"")}}},forceStyles:function(C,B){C=z(C);if(C.attr("style")){C.data("styles",C.attr("style")).removeAttr("style")}C.css(B)},revertStyles:function(){z.each(f.array(arguments),function(C,B){B=z(B);B.removeAttr("style");B.attr("style","");if(B.data("styles")){B.attr("style",B.data("styles")).data("styles",null)}})},moveOut:function(B){f.forceStyles(B,{position:"absolute",left:-10000})},moveIn:function(){f.revertStyles.apply(f,f.array(arguments))},elem:function(B){if(B instanceof z){return{$:B,dom:B[0]}}else{return{$:z(B),dom:B}}},hide:function(E,F,H){H=H||function(){};var D=f.elem(E),G=D.$;E=D.dom;if(!G.data("opacity")){G.data("opacity",G.css("opacity"))}var C={opacity:0};if(F){var B=b<9&&E?function(){f.removeAlpha(E);E.style.visibility="hidden";H.call(E)}:H;f.animate(E,C,{duration:F,complete:B,stop:true})}else{if(b<9&&E){f.removeAlpha(E);E.style.visibility="hidden"}else{G.css(C)}}},show:function(G,C,I){I=I||function(){};var D=f.elem(G),E=D.$;G=D.dom;var B=parseFloat(E.data("opacity"))||1,H={opacity:B};if(C){if(b<9){E.css("opacity",0);G.style.visibility="visible"}var F=b<9&&G?function(){if(H.opacity==1){f.removeAlpha(G)}I.call(G)}:I;f.animate(G,H,{duration:C,complete:F,stop:true})}else{if(b<9&&H.opacity==1&&G){f.removeAlpha(G);G.style.visibility="visible"}else{E.css(H)}}},optimizeTouch:(function(){var B,E,D,I,C={},H=function(J){J.preventDefault();C=z.extend({},J,true)},F=function(){this.evt=C},G=function(){this.handler.call(B,this.evt)};return function(J){z(J).bind("touchend",function(K){B=K.target;I=true;while(B.parentNode&&B!=K.currentTarget&&I){E=z(B).data("events");D=z(B).data("fakes");if(E&&"click" in E){I=false;K.preventDefault();z(B).click(H).click();E.click.pop();z.each(E.click,F);z(B).data("fakes",E.click);delete E.click}else{if(D){I=false;K.preventDefault();z.each(D,G)}}B=B.parentNode}})}}()),addTimer:function(){l.add.apply(l,f.array(arguments));return this},clearTimer:function(){l.clear.apply(l,f.array(arguments));return this},wait:function(E){E=z.extend({until:function(){return false},success:function(){},error:function(){Galleria.raise("Could not complete wait function.")},timeout:3000},E);var D=f.timestamp(),C,F,B=function(){F=f.timestamp();C=F-D;if(E.until(C)){E.success();return false}if(F>=D+E.timeout){E.error();return false}r.setTimeout(B,10)};r.setTimeout(B,10)},toggleQuality:function(B,C){if((b!==7&&b!==8)||!B){return}if(typeof C==="undefined"){C=B.style.msInterpolationMode==="nearest-neighbor"}B.style.msInterpolationMode=C?"bicubic":"nearest-neighbor"},insertStyleTag:function(B){var C=c.createElement("style");n().head.appendChild(C);if(C.styleSheet){C.styleSheet.cssText=B}else{var D=c.createTextNode(B);C.appendChild(D)}},loadScript:function(C,E){var B=false,D=z("<scr"+"ipt>").attr({src:C,async:true}).get(0);D.onload=D.onreadystatechange=function(){if(!B&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){B=true;D.onload=D.onreadystatechange=null;if(typeof E==="function"){E.call(this,this)}}};n().head.appendChild(D)},parseValue:function(C){if(typeof C==="number"){return C}else{if(typeof C==="string"){var B=C.match(/\-?\d|\./g);return B&&B.constructor===Array?B.join("")*1:0}else{return 0}}},timestamp:function(){return new Date().getTime()},loadCSS:function(E,B,G){var C,D=false,F;z("link[rel=stylesheet]").each(function(){if(new RegExp(E).test(this.href)){C=this;return false}});if(typeof B==="function"){G=B;B=g}G=G||function(){};if(C){G.call(C,C);return C}F=c.styleSheets.length;if(z("#"+B).length){z("#"+B).attr("href",E);F--;D=true}else{C=z("<link>").attr({rel:"stylesheet",href:E,id:B}).get(0);r.setTimeout(function(){var H=z('link[rel="stylesheet"], style');if(H.length){H.get(0).parentNode.insertBefore(C,H[0])}else{n().head.appendChild(C)}if(b){if(F>=31){Galleria.raise("You have reached the browser stylesheet limit (31)",true);return}C.onreadystatechange=function(I){if(!D&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){D=true}}}else{if(!(new RegExp("file://","i").test(E))){z.ajax({url:E,success:function(){D=true},error:function(I){if(I.isRejected()&&Galleria.WEBKIT){D=true}}})}else{D=true}}},10)}if(typeof G==="function"){f.wait({until:function(){return D&&c.styleSheets.length>F},success:function(){r.setTimeout(function(){G.call(C,C)},100)},error:function(){Galleria.raise("Theme CSS could not load",true)},timeout:10000})}return C}}}()),h=(function(){var B=function(D,H,C,J){var F=this.getOptions("easing"),E=this.getStageWidth(),G={left:E*(D.rewind?-1:1)},I={left:0};if(C){G.opacity=0;I.opacity=1}else{G.opacity=1}z(D.next).css(G);f.animate(D.next,I,{duration:D.speed,complete:(function(K){return function(){H();K.css({left:0})}}(z(D.next).add(D.prev))),queue:false,easing:F});if(J){D.rewind=!D.rewind}if(D.prev){G={left:0};I={left:E*(D.rewind?1:-1)};if(C){G.opacity=1;I.opacity=0}z(D.prev).css(G);f.animate(D.prev,I,{duration:D.speed,queue:false,easing:F,complete:function(){z(this).css("opacity",0)}})}};return{fade:function(C,D){z(C.next).css({opacity:0,left:0}).show();f.animate(C.next,{opacity:1},{duration:C.speed,complete:D});if(C.prev){z(C.prev).css("opacity",1).show();f.animate(C.prev,{opacity:0},{duration:C.speed})}},flash:function(C,D){z(C.next).css({opacity:0,left:0});if(C.prev){f.animate(C.prev,{opacity:0},{duration:C.speed/2,complete:function(){f.animate(C.next,{opacity:1},{duration:C.speed,complete:D})}})}else{f.animate(C.next,{opacity:1},{duration:C.speed,complete:D})}},pulse:function(C,D){if(C.prev){z(C.prev).hide()}z(C.next).css({opacity:0,left:0}).show();f.animate(C.next,{opacity:1},{duration:C.speed,complete:D})},slide:function(C,D){B.apply(this,f.array(arguments))},fadeslide:function(C,D){B.apply(this,f.array(arguments).concat([true]))},doorslide:function(C,D){B.apply(this,f.array(arguments).concat([false,true]))}}}());Galleria=function(){var J=this;this._theme=g;this._options={};this._playing=false;this._playtime=5000;this._active=null;this._queue={length:0};this._data=[];this._dom={};this._thumbnails=[];this._layers=[];this._initialized=false;this._firstrun=false;this._stageWidth=0;this._stageHeight=0;this._target=g;this._id=Math.random();var E="container stage images image-nav image-nav-left image-nav-right "+"info info-text info-title info-description "+"thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right "+"loader counter tooltip",D="current total";z.each(E.split(" "),function(M,L){J._dom[L]=f.create("galleria-"+L)});z.each(D.split(" "),function(M,L){J._dom[L]=f.create("galleria-"+L,"span")});var K=this._keyboard={keys:{"UP":38,"DOWN":40,"LEFT":37,"RIGHT":39,"RETURN":13,"ESCAPE":27,"BACKSPACE":8,"SPACE":32},map:{},bound:false,press:function(M){var L=M.keyCode||M.which;if(L in K.map&&typeof K.map[L]==="function"){K.map[L].call(J,M)}},attach:function(N){var M,L;for(M in N){if(N.hasOwnProperty(M)){L=M.toUpperCase();if(L in K.keys){K.map[K.keys[L]]=N[M]}else{K.map[L]=N[M]}}}if(!K.bound){K.bound=true;t.bind("keydown",K.press)}},detach:function(){K.bound=false;K.map={};t.unbind("keydown",K.press)}};var I=this._controls={0:g,1:g,active:0,swap:function(){I.active=I.active?0:1},getActive:function(){return I[I.active]},getNext:function(){return I[1-I.active]}};var G=this._carousel={next:J.$("thumb-nav-right"),prev:J.$("thumb-nav-left"),width:0,current:0,max:0,hooks:[],update:function(){var L=0,M=0,N=[0];z.each(J._thumbnails,function(P,O){if(O.ready){L+=O.outerWidth||z(O.container).outerWidth(true);N[P+1]=L;M=Math.max(M,O.outerHeight||z(O.container).outerHeight(true))}});J.$("thumbnails").css({width:L,height:M});G.max=L;G.hooks=N;G.width=J.$("thumbnails-list").width();G.setClasses();J.$("thumbnails-container").toggleClass("galleria-carousel",L>G.width);G.width=J.$("thumbnails-list").width()},bindControls:function(){var L;G.next.bind("click",function(M){M.preventDefault();if(J._options.carouselSteps==="auto"){for(L=G.current;L<G.hooks.length;L++){if(G.hooks[L]-G.hooks[G.current]>G.width){G.set(L-2);break}}}else{G.set(G.current+J._options.carouselSteps)}});G.prev.bind("click",function(M){M.preventDefault();if(J._options.carouselSteps==="auto"){for(L=G.current;L>=0;L--){if(G.hooks[G.current]-G.hooks[L]>G.width){G.set(L+2);break}else{if(L===0){G.set(0);break}}}}else{G.set(G.current-J._options.carouselSteps)}})},set:function(L){L=Math.max(L,0);while(G.hooks[L-1]+G.width>=G.max&&L>=0){L--}G.current=L;G.animate()},getLast:function(L){return(L||G.current)-1},follow:function(L){if(L===0||L===G.hooks.length-2){G.set(L);return}var M=G.current;while(G.hooks[M]-G.hooks[G.current]<G.width&&M<=G.hooks.length){M++}if(L-1<G.current){G.set(L-1)}else{if(L+2>M){G.set(L-M+G.current+2)}}},setClasses:function(){G.prev.toggleClass("disabled",!G.current);G.next.toggleClass("disabled",G.hooks[G.current]+G.width>=G.max)},animate:function(L){G.setClasses();var M=G.hooks[G.current]*-1;if(isNaN(M)){return}f.animate(J.get("thumbnails"),{left:M},{duration:J._options.carouselSpeed,easing:J._options.easing,queue:false})}};var F=this._tooltip={initialized:false,open:false,init:function(){F.initialized=true;var L=".galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3"+"opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}";f.insertStyleTag(L);J.$("tooltip").css("opacity",0.8);f.hide(J.get("tooltip"))},move:function(R){var S=J.getMousePosition(R).x,L=J.getMousePosition(R).y,U=J.$("tooltip"),N=S,O=L,Q=U.outerHeight(true)+1,M=U.outerWidth(true),T=Q+15;var P=J.$("container").width()-M-2,V=J.$("container").height()-Q-2;if(!isNaN(N)&&!isNaN(O)){N+=10;O-=30;N=Math.max(0,Math.min(P,N));O=Math.max(0,Math.min(V,O));if(L<T){O=T}U.css({left:N,top:O})}},bind:function(M,L){if(Galleria.TOUCH){return}if(!F.initialized){F.init()}var N=function(P,O){F.define(P,O);z(P).hover(function(){f.clearTimer("switch_tooltip");J.$("container").unbind("mousemove",F.move).bind("mousemove",F.move).trigger("mousemove");F.show(P);Galleria.utils.addTimer("tooltip",function(){J.$("tooltip").stop().show().animate({opacity:1});F.open=true},F.open?0:500)},function(){J.$("container").unbind("mousemove",F.move);f.clearTimer("tooltip");J.$("tooltip").stop().animate({opacity:0},200,function(){J.$("tooltip").hide();f.addTimer("switch_tooltip",function(){F.open=false},1000)})})};if(typeof L==="string"){N((M in J._dom?J.get(M):M),L)}else{z.each(M,function(O,P){N(J.get(O),P)})}},show:function(M){M=z(M in J._dom?J.get(M):M);var N=M.data("tt"),L=function(O){r.setTimeout((function(P){return function(){F.move(P)}}(O)),10);M.unbind("mouseup",L)};N=typeof N==="function"?N():N;if(!N){return}J.$("tooltip").html(N.replace(/\s/,"&nbsp;"));M.bind("mouseup",L)},define:function(M,L){if(typeof L!=="function"){var N=L;L=function(){return N}}M=z(M in J._dom?J.get(M):M).data("tt",L);F.show(M)}};var C=this._fullscreen={scrolled:0,crop:g,transition:g,active:false,keymap:J._keyboard.map,enter:function(S){C.active=true;f.hide(J.getActiveImage());J.$("container").addClass("fullscreen");C.scrolled=u.scrollTop();f.forceStyles(J.get("container"),{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:10000});var N={height:"100%",overflow:"hidden",margin:0,padding:0},P=J.getData(),L=J._options;f.forceStyles(n().html,N);f.forceStyles(n().body,N);C.keymap=z.extend({},J._keyboard.map);J.attachKeyboard({escape:J.exitFullscreen,right:J.next,left:J.prev});C.crop=L.imageCrop;if(L.fullscreenCrop!=g){L.imageCrop=L.fullscreenCrop}if(P&&P.big&&P.image!==P.big){var M=new Galleria.Picture(),R=M.isCached(P.big),O=J.getIndex(),Q=J._thumbnails[O];J.trigger({type:Galleria.LOADSTART,cached:R,rewind:false,index:O,imageTarget:J.getActiveImage(),thumbTarget:Q});M.load(P.big,function(T){J._scaleImage(T,{complete:function(V){J.trigger({type:Galleria.LOADFINISH,cached:R,index:O,rewind:false,imageTarget:V.image,thumbTarget:Q});var U=J._controls.getActive().image;if(U){z(U).width(V.image.width).height(V.image.height).attr("style",z(V.image).attr("style")).attr("src",V.image.src)}}})})}J.rescale(function(){f.addTimer("fullscreen_enter",function(){f.show(J.getActiveImage());if(typeof S==="function"){S.call(J)}},100);J.trigger(Galleria.FULLSCREEN_ENTER)});u.resize(function(){C.scale()})},scale:function(){J.rescale()},exit:function(N){C.active=false;f.hide(J.getActiveImage());J.$("container").removeClass("fullscreen");f.revertStyles(J.get("container"),n().html,n().body);r.scrollTo(0,C.scrolled);J.detachKeyboard();J.attachKeyboard(C.keymap);J._options.imageCrop=C.crop;var L=J.getData().big,M=J._controls.getActive().image;if(L&&L==M.src){r.setTimeout(function(O){return function(){M.src=O}}(J.getData().image),1)}J.rescale(function(){f.addTimer("fullscreen_exit",function(){f.show(J.getActiveImage());if(typeof N==="function"){N.call(J)}},50);J.trigger(Galleria.FULLSCREEN_EXIT)});u.unbind("resize",C.scale)}};var B=this._idle={trunk:[],bound:false,add:function(O,M){if(!O){return}if(!B.bound){B.addEvent()}O=z(O);var L={},N;for(N in M){if(M.hasOwnProperty(N)){L[N]=O.css(N)}}O.data("idle",{from:L,to:M,complete:true,busy:false});B.addTimer();B.trunk.push(O)},remove:function(L){L=jQuery(L);z.each(B.trunk,function(N,M){if(M.length&&!M.not(L).length){J._idle.show(L);J._idle.trunk.splice(N,1)}});if(!B.trunk.length){B.removeEvent();f.clearTimer("idle")}},addEvent:function(){B.bound=true;J.$("container").bind("mousemove click",B.showAll)},removeEvent:function(){B.bound=false;J.$("container").unbind("mousemove click",B.showAll)},addTimer:function(){f.addTimer("idle",function(){J._idle.hide()},J._options.idleTime)},hide:function(){if(!J._options.idleMode){return}J.trigger(Galleria.IDLE_ENTER);z.each(B.trunk,function(M,L){var N=L.data("idle");if(!N){return}L.data("idle").complete=false;f.animate(L,N.to,{duration:J._options.idleSpeed})})},showAll:function(){f.clearTimer("idle");z.each(J._idle.trunk,function(M,L){J._idle.show(L)})},show:function(L){var M=L.data("idle");if(!M.busy&&!M.complete){M.busy=true;J.trigger(Galleria.IDLE_EXIT);f.clearTimer("idle");f.animate(L,M.from,{duration:J._options.idleSpeed/2,complete:function(){z(this).data("idle").busy=false;z(this).data("idle").complete=true}})}B.addTimer()}};var H=this._lightbox={width:0,height:0,initialized:false,active:null,image:null,elems:{},keymap:false,init:function(){J.trigger(Galleria.LIGHTBOX_OPEN);if(H.initialized){return}H.initialized=true;var O="overlay box content shadow title info close prevholder prev nextholder next counter image",P={},T=J._options,S="",Q="position:absolute;",N="lightbox-",R={overlay:"position:fixed;display:none;opacity:"+T.overlayOpacity+";filter:alpha(opacity="+(T.overlayOpacity*100)+");top:0;left:0;width:100%;height:100%;background:"+T.overlayBackground+";z-index:99990",box:"position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991",shadow:Q+"background:#000;width:100%;height:100%;",content:Q+"background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden",info:Q+"bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px",close:Q+"top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999",image:Q+"top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;",prevholder:Q+"width:50%;top:0;bottom:40px;cursor:pointer;",nextholder:Q+"width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;",prev:Q+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif",next:Q+"top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000",title:"float:left",counter:"float:right;margin-left:8px;"},L=function(U){return U.hover(function(){z(this).css("color","#bbb")},function(){z(this).css("color","#444")})},M={};if(b===8){R.nextholder+="background:#000;filter:alpha(opacity=0);";R.prevholder+="background:#000;filter:alpha(opacity=0);"}z.each(R,function(V,U){S+=".galleria-"+N+V+"{"+U+"}"});f.insertStyleTag(S);z.each(O.split(" "),function(V,U){J.addElement("lightbox-"+U);P[U]=H.elems[U]=J.get("lightbox-"+U)});H.image=new Galleria.Picture();z.each({box:"shadow content close prevholder nextholder",info:"title counter",content:"info image",prevholder:"prev",nextholder:"next"},function(U,W){var V=[];z.each(W.split(" "),function(X,Y){V.push(N+Y)});M[N+U]=V});J.append(M);z(P.image).append(H.image.container);z(n().body).append(P.overlay,P.box);f.optimizeTouch(P.box);L(z(P.close).bind("click",H.hide).html("&#215;"));z.each(["Prev","Next"],function(X,U){var W=z(P[U.toLowerCase()]).html(/v/.test(U)?"&#8249;&nbsp;":"&nbsp;&#8250;"),V=z(P[U.toLowerCase()+"holder"]);V.bind("click",function(){H["show"+U]()});if(b<8||Galleria.TOUCH){W.show();return}V.hover(function(){W.show()},function(Y){W.stop().fadeOut(200)})});z(P.overlay).bind("click",H.hide);if(Galleria.IPAD){J._options.lightboxTransitionSpeed=0}},rescale:function(P){var O=Math.min(u.width()-40,H.width),M=Math.min(u.height()-60,H.height),L=Math.min(O/H.width,M/H.height),Q=Math.round(H.width*L)+40,R=Math.round(H.height*L)+60,N={width:Q,height:R,"margin-top":Math.ceil(R/2)*-1,"margin-left":Math.ceil(Q/2)*-1};if(P){z(H.elems.box).css(N)}else{z(H.elems.box).animate(N,{duration:J._options.lightboxTransitionSpeed,easing:J._options.easing,complete:function(){var T=H.image,S=J._options.lightboxFadeSpeed;J.trigger({type:Galleria.LIGHTBOX_IMAGE,imageTarget:T.image});z(T.container).show();f.show(T.image,S);f.show(H.elems.info,S)}})}},hide:function(){H.image.image=null;u.unbind("resize",H.rescale);z(H.elems.box).hide();f.hide(H.elems.info);J.detachKeyboard();J.attachKeyboard(H.keymap);H.keymap=false;f.hide(H.elems.overlay,200,function(){z(this).hide().css("opacity",J._options.overlayOpacity);J.trigger(Galleria.LIGHTBOX_CLOSE)})},showNext:function(){H.show(J.getNext(H.active))},showPrev:function(){H.show(J.getPrev(H.active))},show:function(N){H.active=N=typeof N==="number"?N:J.getIndex();if(!H.initialized){H.init()}if(!H.keymap){H.keymap=z.extend({},J._keyboard.map);J.attachKeyboard({escape:H.hide,right:H.showNext,left:H.showPrev})}u.unbind("resize",H.rescale);var O=J.getData(N),P=J.getDataLength(),M=J.getNext(N),S,R,L;f.hide(H.elems.info);try{for(L=J._options.preload;L>0;L--){R=new Galleria.Picture();S=J.getData(M);R.preload("big" in S?S.big:S.image);M=J.getNext(M)}}catch(Q){}H.image.load(O.big||O.image,function(T){H.width=T.original.width;H.height=T.original.height;z(T.image).css({width:"100.5%",height:"100.5%",top:0,zIndex:99998});f.hide(T.image);H.elems.title.innerHTML=O.title||"";H.elems.counter.innerHTML=(N+1)+" / "+P;u.resize(H.rescale);H.rescale()});z(H.elems.overlay).show();z(H.elems.box).show()}};return this};Galleria.prototype={constructor:Galleria,init:function(B,D){var C=this;D=m(D);this._original={target:B,options:D,data:null};this._target=this._dom.target=B.nodeName?B:z(B).get(0);a.push(this);if(!this._target){Galleria.raise("Target not found.",true);return}this._options={autoplay:false,carousel:true,carouselFollow:true,carouselSpeed:400,carouselSteps:"auto",clicknext:false,dataConfig:function(E){return{}},dataSelector:"img",dataSource:this._target,debug:g,dummy:g,easing:"galleria",extend:function(E){},fullscreenCrop:g,fullscreenDoubleTap:true,fullscreenTransition:g,height:"auto",idleMode:true,idleTime:3000,idleSpeed:200,imageCrop:false,imageMargin:0,imagePan:false,imagePanSmoothness:12,imagePosition:"50%",imageTimeout:g,initialTransition:g,keepSource:false,layerFollow:true,lightbox:false,lightboxFadeSpeed:200,lightboxTransitionSpeed:200,linkSourceImages:true,maxScaleRatio:g,minScaleRatio:g,overlayOpacity:0.85,overlayBackground:"#0b0b0b",pauseOnInteraction:true,popupLinks:false,preload:2,queue:true,show:0,showInfo:true,showCounter:true,showImagenav:true,swipe:true,thumbCrop:true,thumbEventType:"click",thumbFit:true,thumbMargin:0,thumbQuality:"auto",thumbnails:true,touchTransition:g,transition:"fade",transitionInitial:g,transitionSpeed:400,useCanvas:false,width:"auto"};this._options.initialTransition=this._options.initialTransition||this._options.transitionInitial;if(D&&D.debug===false){d=false}if(D&&typeof D.imageTimeout==="number"){j=D.imageTimeout}if(D&&typeof D.dummy==="string"){q=D.dummy}z(this._target).children().hide();if(typeof Galleria.theme==="object"){this._init()}else{o.push(this)}return this},_init:function(){var D=this,E=this._options;if(this._initialized){Galleria.raise("Init failed: Gallery instance already initialized.");return this}this._initialized=true;if(!Galleria.theme){Galleria.raise("Init failed: No theme found.");return this}z.extend(true,E,Galleria.theme.defaults,this._original.options);(function(F){if(!("getContext" in F)){F=null;return}p=p||{elem:F,context:F.getContext("2d"),cache:{},length:0}}(c.createElement("canvas")));this.bind(Galleria.DATA,function(){if(Galleria.QUIRK){Galleria.raise("Your page is in Quirks mode, Galleria may not render correctly. Please validate your HTML.")}this._original.data=this._data;this.get("total").innerHTML=this.getDataLength();var F=this.$("container");var H={width:0,height:0};var G=function(){return D.$("stage").height()};f.wait({until:function(){z.each(["width","height"],function(J,I){if(E[I]&&typeof E[I]==="number"){H[I]=E[I]}else{H[I]=Math.max(f.parseValue(F.css(I)),f.parseValue(D.$("target").css(I)),F[I](),D.$("target")[I]())}F[I](H[I])});return G()&&H.width&&H.height>10},success:function(){if(Galleria.WEBKIT){r.setTimeout(function(){D._run()},1)}else{D._run()}},error:function(){if(G()){Galleria.raise("Could not extract sufficient width/height of the gallery container. Traced measures: width:"+H.width+"px, height: "+H.height+"px.",true)}else{Galleria.raise("Could not extract a stage height from the CSS. Traced height: "+G()+"px.",true)}},timeout:10000})});this.append({"info-text":["info-title","info-description"],"info":["info-text"],"image-nav":["image-nav-right","image-nav-left"],"stage":["images","loader","counter","image-nav"],"thumbnails-list":["thumbnails"],"thumbnails-container":["thumb-nav-left","thumbnails-list","thumb-nav-right"],"container":["stage","thumbnails-container","info","tooltip"]});f.hide(this.$("counter").append(this.get("current"),c.createTextNode(" / "),this.get("total")));this.setCounter("&#8211;");f.hide(D.get("tooltip"));this.$("container").addClass(Galleria.TOUCH?"touch":"notouch");z.each(new Array(2),function(F){var G=new Galleria.Picture();z(G.container).css({position:"absolute",top:0,left:0}).prepend(D._layers[F]=z(f.create("galleria-layer")).css({position:"absolute",top:0,left:0,right:0,bottom:0,zIndex:2})[0]);D.$("images").append(G.container);D._controls[F]=G});this.$("images").css({position:"relative",top:0,left:0,width:"100%",height:"100%"});this.$("thumbnails, thumbnails-list").css({overflow:"hidden",position:"relative"});this.$("image-nav-right, image-nav-left").bind("click",function(G){if(E.clicknext){G.stopPropagation()}if(E.pauseOnInteraction){D.pause()}var F=/right/.test(this.className)?"next":"prev";D[F]()});z.each(["info","counter","image-nav"],function(G,F){if(E["show"+F.substr(0,1).toUpperCase()+F.substr(1).replace(/-/,"")]===false){f.moveOut(D.get(F.toLowerCase()))}});this.load();if(!E.keepSource&&!b){this._target.innerHTML=""}if(this.get("errors")){this.appendChild("target","errors")}this.appendChild("target","container");if(E.carousel){var B=0,C=E.show;this.bind(Galleria.THUMBNAIL,function(){this.updateCarousel();if(++B==this.getDataLength()&&typeof C=="number"&&C>0){this._carousel.follow(C)}})}if(E.swipe){(function(K){var L=[0,0],P=[0,0],G=30,N=100,Q=false,I=0,J,F={start:"touchstart",move:"touchmove",stop:"touchend"},O=function(R){return R.originalEvent.touches?R.originalEvent.touches[0]:R},H=function(R){if(R.originalEvent.touches&&R.originalEvent.touches.length>1){return}J=O(R);P=[J.pageX,J.pageY];if(!L[0]){L=P}if(Math.abs(L[0]-P[0])>10){R.preventDefault()}},M=function(R){K.unbind(F.move,H);if((R.originalEvent.touches&&R.originalEvent.touches.length)||Q){Q=!Q;return}if(f.timestamp()-I<1000&&Math.abs(L[0]-P[0])>G&&Math.abs(L[1]-P[1])<N){R.preventDefault();D[L[0]>P[0]?"next":"prev"]()}L=P=[0,0]};K.bind(F.start,function(R){if(R.originalEvent.touches&&R.originalEvent.touches.length>1){return}J=O(R);I=f.timestamp();L=P=[J.pageX,J.pageY];K.bind(F.move,H).one(F.stop,M)})}(D.$("images")));if(E.fullscreenDoubleTap){this.$("stage").bind("touchstart",(function(){var L,J,I,F,G,K,H=function(M){return M.originalEvent.touches?M.originalEvent.touches[0]:M};return function(M){K=Galleria.utils.timestamp();J=H(M).pageX;I=H(M).pageY;if((K-L<500)&&(J-F<20)&&(I-G<20)){D.toggleFullscreen();M.preventDefault();D.$("stage").unbind("touchend",arguments.callee);return}L=K;F=J;G=I}}()))}}f.optimizeTouch(this.get("container"));return this},_createThumbnails:function(){this.get("total").innerHTML=this.getDataLength();var B,L,E,G,H,M=this,F=this._options,C=(function(){var O=M.$("thumbnails").find(".active");if(!O.length){return false}return O.find("img").attr("src")}()),J=typeof F.thumbnails==="string"?F.thumbnails.toLowerCase():null,I=function(O){return c.defaultView&&c.defaultView.getComputedStyle?c.defaultView.getComputedStyle(E.container,null)[O]:H.css(O)},K=function(Q,P,O){return function(){z(O).append(Q);M.trigger({type:Galleria.THUMBNAIL,thumbTarget:Q,index:P})}},D=function(O){if(F.pauseOnInteraction){M.pause()}var P=z(O.currentTarget).data("index");if(M.getIndex()!==P){M.show(P)}O.preventDefault()},N=function(O){O.scale({width:O.data.width,height:O.data.height,crop:F.thumbCrop,margin:F.thumbMargin,canvas:F.useCanvas,complete:function(R){var P=["left","top"],Q=["Width","Height"],T,S;z.each(Q,function(V,U){T=U.toLowerCase();if((F.thumbCrop!==true||F.thumbCrop===T)&&F.thumbFit){S={};S[T]=R[T];z(R.container).css(S);S={};S[P[V]]=0;z(R.image).css(S)}R["outer"+U]=z(R.container)["outer"+U](true)});f.toggleQuality(R.image,F.thumbQuality===true||(F.thumbQuality==="auto"&&R.original.width<R.width*3));M.trigger({type:Galleria.THUMBNAIL,thumbTarget:R.image,index:R.data.order})}})};this._thumbnails=[];this.$("thumbnails").empty();for(B=0;this._data[B];B++){G=this._data[B];if(F.thumbnails===true){E=new Galleria.Picture(B);L=G.thumb||G.image;this.$("thumbnails").append(E.container);H=z(E.container);E.data={width:f.parseValue(I("width")),height:f.parseValue(I("height")),order:B};if(F.thumbFit&&F.thumbCrop!==true){H.css({width:0,height:0})}else{H.css({width:E.data.width,height:E.data.height})}E.load(L,N);if(F.preload==="all"){E.preload(G.image)}}else{if(J==="empty"||J==="numbers"){E={container:f.create("galleria-image"),image:f.create("img","span"),ready:true};if(J==="numbers"){z(E.image).text(B+1)}this.$("thumbnails").append(E.container);r.setTimeout((K)(E.image,B,E.container),50+(B*20))}else{E={container:null,image:null}}}z(E.container).add(F.keepSource&&F.linkSourceImages?G.original:null).data("index",B).bind(F.thumbEventType,D);if(C===L){z(E.container).addClass("active")}this._thumbnails.push(E)}},_run:function(){var B=this;B._createThumbnails();f.wait({until:function(){if(Galleria.OPERA){B.$("stage").css("display","inline-block")}B._stageWidth=B.$("stage").width();B._stageHeight=B.$("stage").height();return(B._stageWidth&&B._stageHeight>50)},success:function(){i.push(B);f.show(B.get("counter"));if(B._options.carousel){B._carousel.bindControls()}if(B._options.autoplay){B.pause();if(typeof B._options.autoplay==="number"){B._playtime=B._options.autoplay}B.trigger(Galleria.PLAY);B._playing=true}if(B._firstrun){if(typeof B._options.show==="number"){B.show(B._options.show)}return}B._firstrun=true;if(B._options.clicknext&&!Galleria.TOUCH){z.each(B._data,function(C,D){delete D.link});B.$("stage").css({cursor:"pointer"}).bind("click",function(C){if(B._options.pauseOnInteraction){B.pause()}B.next()})}if(Galleria.History){Galleria.History.change(function(C){if(isNaN(C)){r.history.go(-1)}else{B.show(C,g,true)}})}z.each(Galleria.ready.callbacks,function(){this.call(B,B._options)});B.trigger(Galleria.READY);Galleria.theme.init.call(B,B._options);B._options.extend.call(B,B._options);if(/^[0-9]{1,4}$/.test(x)&&Galleria.History){B.show(x,g,true)}else{if(B._data[B._options.show]){B.show(B._options.show)}}},error:function(){Galleria.raise("Stage width or height is too small to show the gallery. Traced measures: width:"+B._stageWidth+"px, height: "+B._stageHeight+"px.",true)}})},load:function(E,D,B){var C=this;this._data=[];this._thumbnails=[];this.$("thumbnails").empty();if(typeof D==="function"){B=D;D=null}E=E||this._options.dataSource;D=D||this._options.dataSelector;B=B||this._options.dataConfig;if(/^function Object/.test(E.constructor)){E=[E]}if(E.constructor===Array){if(this.validate(E)){this._data=E;this._parseData().trigger(Galleria.DATA)}else{Galleria.raise("Load failed: JSON Array not valid.")}return this}z(E).find(D).each(function(I,G){G=z(G);var K={},F=G.parent(),J=F.attr("href"),H=F.attr("rel");if(J){K.image=K.big=J}if(H){K.big=H}C._data.push(z.extend({title:G.attr("title")||"",thumb:G.attr("src"),image:G.attr("src"),big:G.attr("src"),description:G.attr("alt")||"",link:G.attr("longdesc"),original:G.get(0)},K,B(G)))});if(this.getDataLength()){this.trigger(Galleria.DATA)}else{Galleria.raise("Load failed: no data found.")}return this},_parseData:function(){var B=this;z.each(this._data,function(C,D){if("thumb" in D===false){B._data[C].thumb=D.image}if(!"big" in D){B._data[C].big=D.image}});return this},splice:function(){Array.prototype.splice.apply(this._data,f.array(arguments));return this._parseData()._createThumbnails()},push:function(){Array.prototype.push.apply(this._data,f.array(arguments));return this._parseData()._createThumbnails()},_getActive:function(){return this._controls.getActive()},validate:function(B){return true},bind:function(C,B){C=s(C);this.$("container").bind(C,this.proxy(B));return this},unbind:function(B){B=s(B);this.$("container").unbind(B);return this},trigger:function(B){B=typeof B==="object"?z.extend(B,{scope:this}):{type:s(B),scope:this};this.$("container").trigger(B);return this},addIdleState:function(C,B){this._idle.add.apply(this._idle,f.array(arguments));return this},removeIdleState:function(B){this._idle.remove.apply(this._idle,f.array(arguments));return this},enterIdleMode:function(){this._idle.hide();return this},exitIdleMode:function(){this._idle.showAll();return this},enterFullscreen:function(B){this._fullscreen.enter.apply(this,f.array(arguments));return this},exitFullscreen:function(B){this._fullscreen.exit.apply(this,f.array(arguments));return this},toggleFullscreen:function(B){this._fullscreen[this.isFullscreen()?"exit":"enter"].apply(this,f.array(arguments));return this},bindTooltip:function(C,B){this._tooltip.bind.apply(this._tooltip,f.array(arguments));return this},defineTooltip:function(C,B){this._tooltip.define.apply(this._tooltip,f.array(arguments));return this},refreshTooltip:function(B){this._tooltip.show.apply(this._tooltip,f.array(arguments));return this},openLightbox:function(){this._lightbox.show.apply(this._lightbox,f.array(arguments));return this},closeLightbox:function(){this._lightbox.hide.apply(this._lightbox,f.array(arguments));return this},getActiveImage:function(){return this._getActive().image||g},getActiveThumb:function(){return this._thumbnails[this._active].image||g},getMousePosition:function(B){return{x:B.pageX-this.$("container").offset().left,y:B.pageY-this.$("container").offset().top}},addPan:function(I){if(this._options.imageCrop===false){return}I=z(I||this.getActiveImage());var Q=this,R=I.width()/2,C=I.height()/2,D=parseInt(I.css("left"),10),E=parseInt(I.css("top"),10),L=D||0,M=E||0,J=0,K=0,G=false,B=f.timestamp(),O=0,H=0,N=function(S,V,U){if(S>0){H=Math.round(Math.max(S*-1,Math.min(0,V)));if(O!==H){O=H;if(b===8){I.parent()["scroll"+U](H*-1)}else{var T={};T[U.toLowerCase()]=H;I.css(T)}}}},P=function(S){if(f.timestamp()-B<50){return}G=true;R=Q.getMousePosition(S).x;C=Q.getMousePosition(S).y},F=function(S){if(!G){return}J=I.width()-Q._stageWidth;K=I.height()-Q._stageHeight;D=R/Q._stageWidth*J*-1;E=C/Q._stageHeight*K*-1;L+=(D-L)/Q._options.imagePanSmoothness;M+=(E-M)/Q._options.imagePanSmoothness;N(K,M,"Top");N(J,L,"Left")};if(b===8){I.parent().scrollTop(M*-1).scrollLeft(L*-1);I.css({top:0,left:0})}this.$("stage").unbind("mousemove",P).bind("mousemove",P);f.addTimer("pan",F,50,true);return this},proxy:function(B,C){if(typeof B!=="function"){return function(){}}C=C||this;return function(){return B.apply(C,f.array(arguments))}},removePan:function(){this.$("stage").unbind("mousemove");f.clearTimer("pan");return this},addElement:function(C){var B=this._dom;z.each(f.array(arguments),function(E,D){B[D]=f.create("galleria-"+D)});return this},attachKeyboard:function(B){this._keyboard.attach.apply(this._keyboard,f.array(arguments));return this},detachKeyboard:function(){this._keyboard.detach.apply(this._keyboard,f.array(arguments));return this},appendChild:function(C,B){this.$(C).append(this.get(B)||B);return this},prependChild:function(C,B){this.$(C).prepend(this.get(B)||B);return this},remove:function(B){this.$(f.array(arguments).join(",")).remove();return this},append:function(D){var B,C;for(B in D){if(D.hasOwnProperty(B)){if(D[B].constructor===Array){for(C=0;D[B][C];C++){this.appendChild(B,D[B][C])}}else{this.appendChild(B,D[B])}}}return this},_scaleImage:function(F,E){F=F||this._controls.getActive();if(!F){return}var D=this,B,C=function(G){z(G.container).children(":first").css({top:Math.max(0,f.parseValue(G.image.style.top)),left:Math.max(0,f.parseValue(G.image.style.left)),width:f.parseValue(G.image.width),height:f.parseValue(G.image.height)})};E=z.extend({width:this._stageWidth,height:this._stageHeight,crop:this._options.imageCrop,max:this._options.maxScaleRatio,min:this._options.minScaleRatio,margin:this._options.imageMargin,position:this._options.imagePosition},E);if(this._options.layerFollow&&this._options.imageCrop!==true){if(typeof E.complete=="function"){B=E.complete;E.complete=function(){B.call(F,F);C(F)}}else{E.complete=C}}else{z(F.container).children(":first").css({top:0,left:0})}F.scale(E);return this},updateCarousel:function(){this._carousel.update();return this},rescale:function(D,C,B){var E=this;if(typeof D==="function"){B=D;D=g}var F=function(){E._stageWidth=D||E.$("stage").width();E._stageHeight=C||E.$("stage").height();E._scaleImage();if(E._options.carousel){E.updateCarousel()}E.trigger(Galleria.RESCALE);if(typeof B==="function"){B.call(E)}};if(Galleria.WEBKIT&&!D&&!C){f.addTimer("scale",F,10)}else{F.call(E)}return this},refreshImage:function(){this._scaleImage();if(this._options.imagePan){this.addPan()}return this},show:function(D,C,B){if(D===false||(!this._options.queue&&this._queue.stalled)){return}D=Math.max(0,Math.min(parseInt(D,10),this.getDataLength()-1));C=typeof C!=="undefined"?!!C:D<this.getIndex();B=B||false;if(!B&&Galleria.History){Galleria.History.set(D.toString());return}this._active=D;Array.prototype.push.call(this._queue,{index:D,rewind:C});if(!this._queue.stalled){this._show()}return this},_show:function(){var N=this,G=this._queue[0],H=this.getData(G.index);if(!H){return}var M=this.isFullscreen()&&"big" in H?H.big:H.image,C=this._controls.getActive(),D=this._controls.getNext(),I=D.isCached(M),E=this._thumbnails[G.index];var L=(function(T,S,R,Q,P){return function(){var U;N._queue.stalled=false;f.toggleQuality(S.image,N._options.imageQuality);N._layers[N._controls.active].innerHTML="";z(R.container).css({zIndex:0,opacity:0}).show();z(S.container).css({zIndex:1}).show();N._controls.swap();if(N._options.imagePan){N.addPan(S.image)}if(T.link||N._options.lightbox){z(S.image).css({cursor:"pointer"}).bind("mouseup",function(){if(T.link){if(N._options.popupLinks){U=r.open(T.link,"_blank")}else{r.location.href=T.link}return}N.openLightbox()})}Array.prototype.shift.call(N._queue);if(N._queue.length){N._show()}N._playCheck();N.trigger({type:Galleria.IMAGE,index:Q.index,imageTarget:S.image,thumbTarget:P.image})}}(H,D,C,G,E));if(this._options.carousel&&this._options.carouselFollow){this._carousel.follow(G.index)}if(this._options.preload){var K,B,F=this.getNext(),O;try{for(B=this._options.preload;B>0;B--){K=new Galleria.Picture();O=N.getData(F);K.preload(this.isFullscreen()&&"big" in O?O.big:O.image);F=N.getNext(F)}}catch(J){}}f.show(D.container);z(N._thumbnails[G.index].container).addClass("active").siblings(".active").removeClass("active");N.trigger({type:Galleria.LOADSTART,cached:I,index:G.index,rewind:G.rewind,imageTarget:D.image,thumbTarget:E.image});D.load(M,function(Q){var P=z(N._layers[1-N._controls.active]).html(H.layer||"").hide();N._scaleImage(Q,{complete:function(T){if("image" in C){f.toggleQuality(C.image,false)}f.toggleQuality(T.image,false);N._queue.stalled=true;N.removePan();N.setInfo(G.index);N.setCounter(G.index);if(H.layer){P.show();if(H.link||N._options.clicknext){P.css("cursor","pointer").one("click",function(){if(H.link){z(T.image).trigger("mouseup")}else{N.$("stage").trigger("click")}})}}N.trigger({type:Galleria.LOADFINISH,cached:I,index:G.index,rewind:G.rewind,imageTarget:T.image,thumbTarget:N._thumbnails[G.index].image});var S=N._options.transition;z.each({initial:C.image===null,touch:Galleria.TOUCH,fullscreen:N.isFullscreen()},function(V,U){if(U&&N._options[V+"Transition"]!==g){S=N._options[V+"Transition"];return false}});if(S in h===false){L()}else{var R={prev:C.container,next:T.container,rewind:G.rewind,speed:N._options.transitionSpeed||400};h[S].call(N,R,L)}}})})},getNext:function(B){B=typeof B==="number"?B:this.getIndex();return B===this.getDataLength()-1?0:B+1},getPrev:function(B){B=typeof B==="number"?B:this.getIndex();return B===0?this.getDataLength()-1:B-1},next:function(){if(this.getDataLength()>1){this.show(this.getNext(),false)}return this},prev:function(){if(this.getDataLength()>1){this.show(this.getPrev(),true)}return this},get:function(B){return B in this._dom?this._dom[B]:null},getData:function(B){return B in this._data?this._data[B]:this._data[this._active]},getDataLength:function(){return this._data.length},getIndex:function(){return typeof this._active==="number"?this._active:false},getStageHeight:function(){return this._stageHeight},getStageWidth:function(){return this._stageWidth},getOptions:function(B){return typeof B==="undefined"?this._options:this._options[B]},setOptions:function(C,B){if(typeof C==="object"){z.extend(this._options,C)}else{this._options[C]=B}return this},play:function(B){this._playing=true;this._playtime=B||this._playtime;this._playCheck();this.trigger(Galleria.PLAY);return this},pause:function(){this._playing=false;this.trigger(Galleria.PAUSE);return this},playToggle:function(B){return(this._playing)?this.pause():this.play(B)},isPlaying:function(){return this._playing},isFullscreen:function(){return this._fullscreen.active},_playCheck:function(){var E=this,C=0,D=20,F=f.timestamp(),G="play"+this._id;if(this._playing){f.clearTimer(G);var B=function(){C=f.timestamp()-F;if(C>=E._playtime&&E._playing){f.clearTimer(G);E.next();return}if(E._playing){E.trigger({type:Galleria.PROGRESS,percent:Math.ceil(C/E._playtime*100),seconds:Math.floor(C/1000),milliseconds:C});f.addTimer(G,B,D)}};f.addTimer(G,B,D)}},setPlaytime:function(B){this._playtime=B;return this},setIndex:function(B){this._active=B;return this},setCounter:function(D){if(typeof D==="number"){D++}else{if(typeof D==="undefined"){D=this.getIndex()+1}}this.get("current").innerHTML=D;if(b){var B=this.$("counter"),C=B.css("opacity");if(parseInt(C,10)===1){f.removeAlpha(B[0])}else{this.$("counter").css("opacity",C)}}return this},setInfo:function(C){var B=this,D=this.getData(C);z.each(["title","description"],function(G,F){var E=B.$("info-"+F);if(!!D[F]){E[D[F].length?"show":"hide"]().html(D[F])}else{E.empty().hide()}});return this},hasInfo:function(D){var B="title description".split(" "),C;for(C=0;B[C];C++){if(!!this.getData(D)[B[C]]){return true}}return false},jQuery:function(C){var D=this,E=[];z.each(C.split(","),function(G,F){F=z.trim(F);if(D.get(F)){E.push(F)}});var B=z(D.get(E.shift()));z.each(E,function(G,F){B=B.add(D.get(F))});return B},$:function(B){return this.jQuery.apply(this,f.array(arguments))}};z.each(v,function(D,B){var C=/_/.test(B)?B.replace(/_/g,""):B;Galleria[B.toUpperCase()]="galleria."+C});z.extend(Galleria,{IE9:b===9,IE8:b===8,IE7:b===7,IE6:b===6,IE:b,WEBKIT:/webkit/.test(k),SAFARI:/safari/.test(k),CHROME:/chrome/.test(k),QUIRK:(b&&c.compatMode&&c.compatMode==="BackCompat"),MAC:/mac/.test(navigator.platform.toLowerCase()),OPERA:!!r.opera,IPHONE:/iphone/.test(k),IPAD:/ipad/.test(k),ANDROID:/android/.test(k),TOUCH:("ontouchstart" in c)});Galleria.addTheme=function(D){if(!D.name){Galleria.raise("No theme name specified")}if(typeof D.defaults!=="object"){D.defaults={}}else{D.defaults=m(D.defaults)}var C=false,B;if(typeof D.css==="string"){z("link").each(function(F,E){B=new RegExp(D.css);if(B.test(E.href)){C=true;w(D);return false}});if(!C){z("script").each(function(F,E){B=new RegExp("galleria\\."+D.name.toLowerCase()+"\\.");if(B.test(E.src)){C=E.src.replace(/[^\/]*$/,"")+D.css;f.addTimer("css",function(){f.loadCSS(C,"galleria-theme",function(){w(D)})},1)}})}if(!C){Galleria.raise("No theme CSS loaded")}}else{w(D)}return D};Galleria.loadTheme=function(F,D){var B=false,E=i.length,C=r.setTimeout(function(){Galleria.raise("Theme at "+F+" could not load, check theme path.",true)},5000);Galleria.theme=g;f.loadScript(F,function(){r.clearTimeout(C);if(E){var G=[];z.each(Galleria.get(),function(J,I){var K=z.extend(I._original.options,{data_source:I._data},D);I.$("container").remove();var H=new Galleria();H._id=I._id;H.init(I._original.target,K);G.push(H)});i=G}})};Galleria.get=function(B){if(!!a[B]){return a[B]}else{if(typeof B!=="number"){return a}else{Galleria.raise("Gallery index "+B+" not found")}}};Galleria.addTransition=function(C,B){h[C]=B};Galleria.utils=f;Galleria.log=(function(){if("console" in r&&"log" in r.console){return r.console.log}else{return function(){r.alert(f.array(arguments).join(", "))}}}());Galleria.ready=function(B){z.each(i,function(D,C){B.call(C,C._options)});Galleria.ready.callbacks.push(B)};Galleria.ready.callbacks=[];Galleria.raise=function(E,C){var D=C?"Fatal error":"Error",F=this,B=function(H){var G='<div style="padding:4px;margin:0 0 2px;background:#'+(C?"811":"222")+'";>'+(C?"<strong>"+D+": </strong>":"")+H+"</div>";z.each(a,function(){var I=this.$("errors"),J=this.$("target");if(!I.length){J.css("position","relative");I=this.addElement("errors").appendChild("target","errors").$("errors").css({color:"#fff",position:"absolute",top:0,left:0,zIndex:100000})}I.append(G)})};if(d){B(E);if(C){throw new Error(D+": "+E)}}else{if(C){if(A){return}A=true;C=false;B("Image gallery could not load.")}}};Galleria.version=e;Galleria.requires=function(B,C){C=C||"You need to upgrade Galleria to version "+B+" to use one or more components.";if(Galleria.version<B){Galleria.raise(C,true)}};Galleria.Picture=function(B){this.id=B||null;this.image=null;this.container=f.create("galleria-image");z(this.container).css({overflow:"hidden",position:"relative"});this.original={width:0,height:0};this.ready=false;this.tid=null};Galleria.Picture.prototype={cache:{},show:function(){f.show(this.image)},hide:function(){f.moveOut(this.image)},clear:function(){this.image=null},isCached:function(B){return !!this.cache[B]},preload:function(B){z(new Image()).load((function(D,C){return function(){C[D]=D}}(B,this.cache))).attr("src",B)},load:function(H,C){this.tid=r.setTimeout((function(I){return function(){Galleria.raise("Image not loaded in "+Math.round(j/1000)+" seconds: "+I)}}(H)),j);this.image=new Image();var G=0,D=false,E=z(this.container),F=z(this.image),B=(function(J,K,I){return function(){var L=function(){z(this).unbind("load");J.original={height:this.height,width:this.width};J.cache[I]=I;r.clearTimeout(J.tid);if(typeof K=="function"){r.setTimeout(function(){K.call(J,J)},1)}};if((!this.width||!this.height)){r.setTimeout((function(M){return function(){if(M.width&&M.height){L.call(M)}else{Galleria.raise("Could not extract width/height from image: "+M.src+". Traced measures: width:"+M.width+"px, height: "+M.height+"px.")}}}(this)),2)}else{L.call(this)}}}(this,C,H));E.find("img").remove();F.css("display","block").appendTo(this.container);f.hide(this.image);if(this.cache[H]){z(this.image).load(B).attr("src",H);return this.container}z(this.image).load(B).error(function(){if(!D){D=true;r.setTimeout((function(I,J){return function(){I.attr("src",J+"?"+f.timestamp())}}(z(this),H)),50)}else{if(q){z(this).attr("src",q)}else{Galleria.raise("Image not found: "+H)}}}).attr("src",H);return this.container},scale:function(F){F=z.extend({width:0,height:0,min:g,max:g,margin:0,complete:function(){},position:"center",crop:false,canvas:false},F);if(!this.image){return this.container}var D,B,E=this,C=z(E.container),G;f.wait({until:function(){D=F.width||C.width()||f.parseValue(C.css("width"));B=F.height||C.height()||f.parseValue(C.css("height"));return D&&B},success:function(){var L=(D-F.margin*2)/E.original.width,M=(B-F.margin*2)/E.original.height,N={"true":Math.max(L,M),"width":L,"height":M,"false":Math.min(L,M)},O=N[F.crop.toString()],P="";if(F.max){O=Math.min(F.max,O)}if(F.min){O=Math.max(F.min,O)}z.each(["width","height"],function(R,Q){z(E.image)[Q](E[Q]=E.image[Q]=Math.round(E.original[Q]*O))});z(E.container).width(D).height(B);if(F.canvas&&p){p.elem.width=E.width;p.elem.height=E.height;P=E.image.src+":"+E.width+"x"+E.height;E.image.src=p.cache[P]||(function(Q){p.context.drawImage(E.image,0,0,E.original.width*O,E.original.height*O);try{G=p.elem.toDataURL();p.length+=G.length;p.cache[Q]=G;return G}catch(R){return E.image.src}}(P))}var K={},I={},J=function(R,U,V){var S=0;if(/\%/.test(R)){var T=parseInt(R,10)/100,Q=E.image[U]||z(E.image)[U]();S=Math.ceil(Q*-1*T+V*T)}else{S=f.parseValue(R)}return S},H={"top":{top:0},"left":{left:0},"right":{left:"100%"},"bottom":{top:"100%"}};z.each(F.position.toLowerCase().split(" "),function(R,Q){if(Q==="center"){Q="50%"}K[R?"top":"left"]=Q});z.each(K,function(R,Q){if(H.hasOwnProperty(Q)){z.extend(I,H[Q])}});K=K.top?z.extend(K,I):I;K=z.extend({top:"50%",left:"50%"},K);z(E.image).css({position:"absolute",top:J(K.top,"height",B),left:J(K.left,"width",D)});E.show();E.ready=true;F.complete.call(E,E)},error:function(){Galleria.raise("Could not scale image: "+E.image.src)},timeout:1000});return this}};z.extend(z.easing,{galleria:function(F,B,C,D,E){if((B/=E/2)<1){return D/2*B*B*B+C}return D/2*((B-=2)*B*B+2)+C},galleriaIn:function(F,B,C,D,E){return D*(B/=E)*B+C},galleriaOut:function(F,B,C,D,E){return -D*(B/=E)*(B-2)+C}});z.fn.galleria=function(B){return this.each(function(){z(this).data("galleria",new Galleria().init(this,B))})}}(jQuery));